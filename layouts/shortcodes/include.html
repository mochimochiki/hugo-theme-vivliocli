{{- $source := .Get 0 }}
{{- $srcName := .Get "src" }}
{{- with $srcName }}{{ $source = $srcName }}{{ end }}
{{- $key := .Get 1 }}
{{- $keyName := .Get "key" }}
{{- with $keyName }}{{ $key = $keyName }}{{ end }}
{{- $column := .Get 2 }}
{{- $columnName := .Get "column" }}
{{- with $columnName }}{{ $column = $columnName }}{{ end }}
{{- $markdown := .Get "markdown" | default true }}
{{- $isMerge := .Get "merge" | default false }}
{{- $class := .Get "class" }}
{{- if and $isMerge (eq $class "") }}{{ $class = "gray" }}{{ end }}
{{- $hasHead := .Get "head" | default true }}
{{- $width := .Get "width" | default "*" }}
{{- $width_list := split (replace ( .Get "width-ratio" | default "*" ) "*" "auto" ) "-" }}
{{- $columns := .Get "columns" }}

{{- $isMD := strings.HasSuffix $source "md" }}
{{- $isCSV := strings.HasSuffix $source "csv" }}
{{- if $isMD }}
  {{- /* markdown 相対パスもしくは_includeフォルダ。画像リンクはassetsフォルダに配置したもののみ相対パス記述可能 */}}
  {{- $mdpath := (path.Join $.Page.File.Dir $source) }}
  {{- if or (fileExists $mdpath ) ( or (hasPrefix $source "./" ) (hasPrefix $source "../" ) )}}
  {{- else }}
    {{- $mdpath = print "_include/" $source }}
  {{- end }}
  {{- $page := .Site.GetPage $mdpath }}
  {{- with $page }}
    {{- $mdURL := printf "/%s/%s" .Site.Language.Lang $mdpath | path.Dir}}
    {{- $content := (replace .Content "<img src=\"assets/" (printf "<img src=\"%s/assets/" $mdURL)) | safeHTML }}
{{ $content }}
  {{- end }}
{{- else if $isCSV}}
  {{- $csvpath := partial "csv/get-csvpath.html" (dict "page" .Page "relPath" $source) }}
  {{- if $key }}
    {{/*  include csv key value  */}}
    {{- partial "csv/render-keyvalue.html" (dict "csvpath" $csvpath "key" $key "column" $column) }}
  {{- else }}
    {{- /* include csv table */}}
    {{- partial "csv/render-table.html" (dict "page" .Page "csvpath" $csvpath "class" $class "width" $width "hasHead" $hasHead "width_list" $width_list "markdown" $markdown "isMerge" $isMerge "columns" $columns)}}
  {{- end }}
{{- end }}

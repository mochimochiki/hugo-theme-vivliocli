{{- $csv_original := .csv }}
{{- $ignore_columns := .ignore_columns }}
{{- /*  一旦 @escape-delimiter@ @real-delimiter@ と表現し、エスケープをもとに戻した後 @real-delimiter@ で分割する  */}}
{{- $ignore_filters := split (replace (replace (replace $ignore_columns "\\," "@escape-delimiter@" ) "," "@real-delimiter@" ) "@escape-delimiter@" ",") "@real-delimiter@" }}
{{- $columnIndexList := slice }}
{{- $csv_result := slice}}
{{- range $row, $rowValues := $csv_original }}
  {{- if eq $row 0 }}
    {{/* == header == */}}
    {{- $row_result := slice}}
    {{- range $columnIndex, $value := $rowValues}}
      {{ $value = partial "csv/trim-column-id.html" $value }}
      {{- if not (in $ignore_filters $value) }}
        {{- /* フィルタ後に残すべき列 */}}
        {{- $columnIndexList = $columnIndexList | append $columnIndex }}
        {{- $row_result = $row_result | append $value }}
      {{- end }}
    {{- end }}
    {{- $csv_result = $csv_result | append (slice $row_result) }}
  {{- else }}
    {{/* == data == */}}
    {{- $row_result := slice}}
    {{- range $columnIndex, $value := $rowValues}}
      {{- if in $columnIndexList $columnIndex }}
        {{- /* フィルタ後に残すべき列 */}}
        {{- $row_result = $row_result | append $value }}
      {{- end }}
    {{- end }}
    {{- $csv_result = $csv_result | append (slice $row_result) }}
  {{- end }}
{{- end }}
{{- return $csv_result }}

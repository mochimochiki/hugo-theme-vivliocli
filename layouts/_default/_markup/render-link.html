{{- $url := .Destination | safeURL | urls.Parse }}
{{- $path := $url.Path }}
{{- if strings.HasSuffix $path "md" }}
  {{- if not (strings.HasPrefix $url.Scheme "http") }}
    {{- $path = $path | replaceRE "\\.md$" ".html" }}
    {{- if ne $url.RawQuery "" }}
      {{- $path = printf "%s?%s" $path $url.RawQuery }}
    {{- end }}
    {{- if ne $url.Fragment "" }}
      {{- $path = printf "%s#%s" $path $url.Fragment }}
    {{- end }}
    {{- $url = $path | safeURL | urls.Parse }}
  {{- end }}
{{- end }}
<a href="{{$url | safeURL}}">{{.Text | safeHTML }}</a>
